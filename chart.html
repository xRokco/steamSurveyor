<!DOCTYPE html>
<html>
	<head>
		<title>Chart</title>
		<!--<link href="skeleton.css" type="text/css" rel="stylesheet" media="screen,projection"/>
		<link href="styles.css" type="text/css" rel="stylesheet" media="screen,projection"/>
		<link href='https://fonts.googleapis.com/css?family=Quattrocento:400,700' rel='stylesheet' type='text/css'>
		<link href='https://fonts.googleapis.com/css?family=Muli:400,700' rel='stylesheet' type='text/css'>-->
		<script src="https://code.jquery.com/jquery-3.2.1.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/moment.js/2.13.0/moment.min.js"></script>
		<script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.6.0/Chart.bundle.min.js"></script>
		<style>
			canvas {
				-moz-user-select: none;
				-webkit-user-select: none;
				-ms-user-select: none;
			}
		</style>
		<script type="text/javascript">
			$( document ).ready(function() {
				
				$.get( "data", function( totaldata ) {
					data = JSON.parse(totaldata.split("###")[0]);
					games = JSON.parse(totaldata.split("###")[1]);
					var fdata = {};
					for (var i = 0; i < data.length; i++) {
						var time = data[i][0].substring(0, 13) + ":00";
						if (fdata[time]) {
							fdata[time][data[i][1]] = fdata[time][data[i][1]] + 1;
						} else {
							fdata[time] = {};
							for (var j = games.length - 1; j >= 0; j--) {
								fdata[time][games[j]] = 0;
							}
							fdata[time][data[i][1]] = 1;
						}
					}

					//console.log(Object.keys(fdata));
					var timeFormat = 'DD/MM/YYYY HH:mm';
					var labels = [];
					for (var i = 0; i < Object.keys(fdata).length; i++) {
						labels[i] = moment(Object.keys(fdata)[i]).format(timeFormat);
					}

					console.log(fdata);

					
		
					function newDate(days) {
						return moment().add(days, 'd').toDate();
					}

					function newDateString(days) {
						return moment().add(days, 'd').format(timeFormat);
					}

					function newTimestamp(days) {
						return moment().add(days, 'd').unix();
					}

					var cdata = [];
					var datasets = [];
					for (var k = 0; k < games.length; k++) {
						cdata[k] = [];
					}
					for(var key in fdata) {
						for (var l = 0; l < games.length; l++) {
							cdata[l].push(fdata[key][games[l]]);
						}
					}

					var color = ['rgba(203, 67, 53, 0.5)', 'rgba(218, 247, 166, 0.5)', 'rgba(255, 195, 0, 0.5)', 'rgba(255, 87, 51, 0.5)', 'rgba(199, 0, 57, 0.5)', 'rgba(144, 12, 63, 0.5)']
					for (var k = 0; k < games.length; k++) {
						datasets.push({backgroundColor: color[k], borderColor: color[k], fill: false,label: games[k], data: cdata[k]});
					}

					//console.log(datasets[0].data[0]);

					var color = Chart.helpers.color;
					var config = {
						type: 'line',
						data: {
							labels: labels,
							datasets: datasets
						},
						options: {
							scales: {
								xAxes: [{
									scaleLabel: {
										display: true,
										labelString: 'Time'
									},
									type: "time",
									time: {
										unit: 'hour'
									}
								}],
								yAxes: [{
									scaleLabel: {
										display: true,
										labelString: 'Minutes'
									},
									ticks: {
										suggestedMin: 0,
										suggestedMax: 60
									}
								}]
							}
						}
					};

					var ctx = document.getElementById("canvas").getContext("2d");
					window.myLine = new Chart(ctx, config);
				});
			});
		</script>
	</head>
	<body id="body">
		<div style="width:75%;">
			<canvas id="canvas"></canvas>
		</div>
	</body>
</html>